package com.example.frg2;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;
import java.util.PriorityQueue;

import android.R.integer;
import android.os.Bundle;
import android.app.Activity;
import android.content.Context;
import android.graphics.Point;
import android.util.DisplayMetrics;
import android.view.Display;
import android.view.Menu;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.WindowManager;
import android.widget.Button;
import android.widget.LinearLayout;
import android.widget.ListView;

public class MainActivity extends Activity 
{
	ListView lst;
	Button btnBack ,btnNext;
	adapter2 adapter;
	ArrayList<struct2> arrays;
	Iterator<PriorityQueue<Integer>> iteratorQueeParent;
	
	@Override
	protected void onCreate(Bundle savedInstanceState) 
	{
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_main);
		
		btnBack = (Button) findViewById(R.id.btnBack);
		btnNext = (Button) findViewById(R.id.btnNext);
		
		arrays = new ArrayList<struct2>();
		for(int i = 0; i<100 ; i++)
		{
			struct2 stru = new struct2();
			stru.setId(i);
			stru.setName("name"+i);
			
			arrays.add(stru);
		}
		
		Map<Integer, Integer> detailsOfColumn = new HashMap<Integer, Integer>();
		detailsOfColumn.put(0, 50);
		detailsOfColumn.put(1, 60);
		/*
		detailsOfColumn.put(2, 40);
		detailsOfColumn.put(3, 80);
		detailsOfColumn.put(4, 55);
		*/
		
		int sumOfAllColumns = 0;
		for(int i=0 ; i< detailsOfColumn.size() ; i++)
		{
			sumOfAllColumns += detailsOfColumn.get(i);
		}
		
		DisplayMetrics metrics = new DisplayMetrics();
		getWindowManager().getDefaultDisplay().getMetrics(metrics);
		//float widthInches = metrics.widthPixels / metrics.xdpi;
		
		PriorityQueue<PriorityQueue<Integer>> queeParent = new PriorityQueue<PriorityQueue<Integer>>();
		int counter = 0;
		int sumParent = 0;
		while(sumParent < sumOfAllColumns)
		{
			int sumChild = 0;
			PriorityQueue<Integer> queeChild = new PriorityQueue<Integer>();
			while(sumChild < metrics.widthPixels)
			{
				if(counter < detailsOfColumn.size())
				{
					queeChild.add(detailsOfColumn.get(counter));
					sumChild += detailsOfColumn.get(counter);
					counter++;
				}
				else
				{
					break;
				}
			}
			sumParent += sumChild;
			queeParent.add(queeChild);
		}
		
		iteratorQueeParent = queeParent.iterator();
		
		if(iteratorQueeParent.hasNext())
		{
			PriorityQueue<Integer> obj = iteratorQueeParent.next();
			Object[] arr = obj.toArray();
			int[] arrToAdapter = new int[arr.length];
			
			for(int i=0 ; i<arr.length ; i++)
			{
				arrToAdapter[i] = getIndexOfValue((Integer) arr[i], detailsOfColumn);
			}
			
			adapter = new adapter2(this, arrays, arrToAdapter);
			lst = (ListView) findViewById(R.id.lst);
			lst.setAdapter(adapter);
		}
		
		btnBack.setOnClickListener(clickBack);
		btnNext.setOnClickListener(clickNext);
	}

	OnClickListener clickNext = new OnClickListener() 
	{
		@Override
		public void onClick(View v) 
		{
			if(iteratorQueeParent.hasNext())
			{
				PriorityQueue<Integer> obj = iteratorQueeParent.next();
				Object[] arr = obj.toArray();
				int[] arrToAdapter = new int[arr.length];
				
				for(int i=0 ; i<arr.length ; i++)
				{
					arrToAdapter[i] = getIndexOfValue((Integer) arr[i], detailsOfColumn);
				}
				
				adapter = new adapter2(this, arrays, arrToAdapter);
				lst = (ListView) findViewById(R.id.lst);
				lst.setAdapter(adapter);
			}
			
			LinearLayout view = (LinearLayout) lst.getChildAt(0);
			int m = view.getChildCount();
			//view.findViewById(344).setVisibility(View.GONE);
			view.getChildAt(0).setVisibility(View.GONE);
			
			
			//adapter = new adapter2(MainActivity.this, arrays, new int[]{1});
			//lst.setAdapter(adapter);
		}
	};
	
	OnClickListener clickBack = new OnClickListener() 
	{
		@Override
		public void onClick(View v) 
		{
			//adapter = new adapter2(MainActivity.this, arrays, new int[]{0});
			lst.setAdapter(adapter);
		}
	};
	
	private int getIndexOfValue(int value , Map<Integer, Integer> detailsOfColumn)
	{
		for(int i=0 ; i<detailsOfColumn.size() ; i++)
		{
			if(detailsOfColumn.get(i).equals(value))
			{
				return i;
			}
		}
		
		return -1;
	}
}
